<!-- Generated by SpecStory -->

# Optimizing prompts for citation markup with AI (2025-06-05 10:24:33)

_**User**_

is this possible to use Gemini Pro 2.5 to finetune the prompt to be used in Gemma3:1b to markup citation string with xml tags as wished result

---

_**Assistant**_

Yes, absolutely! Using Gemini Pro 2.5 to optimize prompts for Gemma 3 1B is a great strategy. Here's a complete implementation for your Jupyter notebook:

````python
import google.generativeai as genai
import json
import re
from typing import List, Dict, Tuple
import time

# Configure Gemini Pro 2.5
genai.configure(api_key="your-gemini-api-key-here")
gemini_pro = genai.GenerativeModel('gemini-2.0-flash-exp')

class CitationPromptOptimizer:
    def __init__(self):
        self.base_examples = [
            "Smith, J. (2023). Machine Learning Fundamentals. Tech Press.",
            "Johnson, A., & Brown, B. (2022). Deep Learning Applications. AI Journal, 15(3), 45-67.",
            "Wilson, C. et al. (2024). Natural Language Processing. Conference Proceedings, pp. 123-135.",
            "Garcia, M. (2021). Computer Vision Techniques. IEEE Transactions on Pattern Analysis, 43(7), 1234-1250."
        ]
        
        self.target_xml_format = """
<citation>
    <authors>Author Name(s)</authors>
    <year>Publication Year</year>
    <title>Title</title>
    <source>Journal/Publisher</source>
    <details>Volume, Issue, Pages if applicable</details>
</citation>"""

    def generate_optimized_prompt(self) -> str:
        """Use Gemini Pro 2.5 to create an optimized prompt for Gemma 3 1B"""
        
        optimization_request = f"""
        Create an optimal prompt for Gemma 3 1B (small language model) to markup academic citations with XML tags.

        Requirements:
        1. Must be under 400 tokens for efficiency
        2. Clear, direct instructions
        3. 2-3 examples maximum
        4. Handle common citation formats (APA, MLA, Chicago)
        5. Consistent XML structure

        Target XML format:
        {self.target_xml_format}

        Sample citations to handle:
        {chr(10).join(self.base_examples)}

        Create a prompt that:
        - Starts with clear task definition
        - Shows 2 complete examples
        - Ends with specific output instructions
        - Uses simple language suitable for smaller models
        
        Format the response as a ready-to-use prompt.
        """
        
        try:
            response = gemini_pro.generate_content(optimization_request)
            return response.text.strip()
        except Exception as e:
            print(f"Error generating prompt: {e}")
            return self._fallback_prompt()

    def _fallback_prompt(self) -> str:
        """Fallback prompt if Gemini Pro fails"""
        return """Task: Convert academic citations to XML markup.

Example 1:
Input: Smith, J. (2023). AI Research. Tech Journal, 5(1), 12-25.
Output:
<citation>
    <authors>Smith, J.</authors>
    <year>2023</year>
    <title>AI Research</title>
    <source>Tech Journal</source>
    <details>5(1), 12-25</details>
</citation>

Example 2:
Input: Brown, A. & Lee, C. (2022). Machine Learning. MIT Press.
Output:
<citation>
    <authors>Brown, A. & Lee, C.</authors>
    <year>2022</year>
    <title>Machine Learning</title>
    <source>MIT Press</source>
    <details></details>
</citation>

Instructions: Extract each component and format as XML. If information is missing, leave the tag empty."""

    def generate_training_examples(self, num_examples: int = 15) -> List[Dict]:
        """Generate diverse training examples using Gemini Pro 2.5"""
        
        example_request = f"""
        Generate {num_examples} diverse academic citations with their XML markup.

        Include variations:
        - Different citation styles (APA, MLA, Chicago)
        - 1-4 authors, some with "et al."
        - Journal articles, books, conference papers
        - With/without page numbers, volumes, issues
        - Different date formats

        XML format to use:
        {self.target_xml_format}

        Return as JSON array:
        [
            {{"citation": "original citation string", "xml": "corresponding xml markup"}},
            ...
        ]

        Make citations realistic and varied.
        """
        
        try:
            response = gemini_pro.generate_content(example_request)
            # Clean the response to extract JSON
            json_text = self._extract_json(response.text)
            examples = json.loads(json_text)
            return examples if isinstance(examples, list) else [examples]
        except Exception as e:
            print(f"Error generating examples: {e}")
            return self._create_fallback_examples()

    def _extract_json(self, text: str) -> str:
        """Extract JSON from response text"""
        # Look for JSON array in the response
        json_match = re.search(r'\[.*\]', text, re.DOTALL)
        if json_match:
            return json_match.group(0)
        return '[]'

    def _create_fallback_examples(self) -> List[Dict]:
        """Create basic examples if generation fails"""
        return [
            {
                "citation": "Anderson, P. (2023). Deep Learning. MIT Press.",
                "xml": "<citation><authors>Anderson, P.</authors><year>2023</year><title>Deep Learning</title><source>MIT Press</source><details></details></citation>"
            }
        ]

    def evaluate_prompt_quality(self, prompt: str, test_citations: List[str]) -> Dict:
        """Evaluate prompt quality using Gemini Pro 2.5"""
        
        evaluation_request = f"""
        Evaluate this prompt for a small language model (Gemma 3 1B) to markup citations:

        PROMPT:
        {prompt}

        TEST CITATIONS:
        {chr(10).join(test_citations)}

        Rate 1-10 on:
        1. Clarity - Are instructions clear?
        2. Examples - Are examples helpful and sufficient?
        3. Conciseness - Is it appropriately brief?
        4. Completeness - Does

---

